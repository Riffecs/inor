<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>INOR PDK Manager: ftp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">INOR PDK Manager
   </div>
   <div id="projectbrief">PDK Package Manager for X-FAB and IMMS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ftp </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Program: pyftpdlib</p>
<h3><a class="anchor" id="autotoc_md0"></a>
Connect to the server</h3>
<p>Disclaimer: The guide works for Almalinux 9, which is installed on the server.</p>
<p>$ ssh <a href="#" onclick="location.href='mai'+'lto:'+'roo'+'t@'+'139'+'.1'+'62.'+'14'+'1.1'+'81'; return false;">root@<span style="display: none;">.nosp@m.</span>139.<span style="display: none;">.nosp@m.</span>162.1<span style="display: none;">.nosp@m.</span>41.1<span style="display: none;">.nosp@m.</span>81</a> Password: copied-comfort-drizzly-ranger-kennel-duly</p>
<h2><a class="anchor" id="autotoc_md1"></a>
On the server</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
Install Program &amp; Dependencies</h3>
<p>$ pip install pyftpdlib $ pip install pyOpenSSL</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Get the git</h3>
<p><strike>$ git clone <a href="https://github.com/giampaolo/pyftpdlib.git">https://github.com/giampaolo/pyftpdlib.git</a></strike> $ git clone <a href="https://github.com/riffecs/inor.git">https://github.com/riffecs/inor.git</a></p>
<h3><a class="anchor" id="autotoc_md4"></a>
Configure a basic ftps-server</h3>
<p><strike>$ cd ./pyftpdlib/demo</strike></p>
<p>$ cd .inor $ vim <a class="el" href="tls__ftpd_8py.html">tls_ftpd.py</a> </p>
<h3><a class="anchor" id="autotoc_md5"></a>
Configure firewall settings</h3>
<div class="fragment"><div class="line">firewall-cmd --permanent --add-port=2121/tcp</div>
<div class="line">firewall-cmd --reload</div>
</div><!-- fragment --><p> <a class="anchor" id="autotoc_md6"></a> </p><h5>Create some virtual users</h5>
<p>Subsitute the line that contains "authorizer.add_user" with the following lines: </p><div class="fragment"><div class="line">authorizer.add_user(&#39;user&#39;, &#39;aghast-unhealthy-sloppy-elastic-referable&#39;, &#39;/root/rion&#39;, perm=&#39;elradfmwMT&#39;)</div>
<div class="line">authorizer.add_user(&#39;basic&#39;, &#39;aghast-unhealthy-sloppy-elastic-referable&#39;, &#39;/root/rion/basic&#39;, perm=&#39;elr&#39;)</div>
<div class="line">authorizer.add_user(&#39;advanced&#39;, &#39;aghast-unhealthy-sloppy-elastic-referable&#39;, &#39;/root/rion/advanced&#39;, perm=&#39;elr&#39;)</div>
<div class="line">authorizer.add_user(&#39;premium&#39;, &#39;aghast-unhealthy-sloppy-elastic-referable&#39;, &#39;/root/rion/premium&#39;, perm=&#39;elr&#39;)</div>
</div><!-- fragment --><p>All those lines are following the same pattern: </p><pre class="fragment">autorizer.add_user('&lt;username&gt;', '&lt;password&gt;', '&lt;root-access-dir', '&lt;user-permission&gt;')
</pre><p> As the name "root-access-dir" indicates, this will be the directory the virutal-user has full access to, including files and subdirectories. The user however will not have accesss to any other directories.</p>
<p>For example: The user basic will have access to everything in the directory "/root/rion/basic". However he will not have access to the content off the folder premium.</p>
<p><a class="anchor" id="autotoc_md7"></a> </p><h5>Changing user permissions</h5>
<p>user permissons are given and changed by adding or removing one or more of the following letters in the &lt;user-permisson&gt; field. </p><pre class="fragment">Read permissions:

-   `"e"` = change directory (CWD, CDUP commands)
-   `"l"` = list files (LIST, NLST, STAT, MLSD, MLST, SIZE commands)
-   `"r"` = retrieve file from the server (RETR command)

Write permissions:

-   `"a"` = append data to an existing file (APPE command)
-   `"d"` = delete file or directory (DELE, RMD commands)
-   `"f"` = rename file or directory (RNFR, RNTO commands)
-   `"m"` = create directory (MKD command)
-   `"w"` = store a file to the server (STOR, STOU commands)
-   `"M"` = change file mode / permission (SITE CHMOD command) _New in 0.7.0_
-   `"T"` = change file modification time (SITE MFMT command) _New in 1.5.3_    
</pre><p> As you can see all of users, exept "user", have read-only permissions.</p>
<p><a class="anchor" id="autotoc_md8"></a> </p><h5>Create the test-directories</h5>
<p>Now that we've created some user, let's make their specified directories.</p>
<p>$ cd $ mkdir rion $ mkdir rion/basic rion/advanced rion/premium</p>
<p><a class="anchor" id="autotoc_md9"></a> </p><h5>Fill those directories with files</h5>
<p>$ touch rion/user.txt $ touch rion/basic/basic.txt $ touch rion/advanced/advanced.txt $ touch rion/premium/premium.txt</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Starting the server</h3>
<p>Now that we're all set, we can start the server:</p>
<p>$ ./root/pyftpdlib/demo/tls_ftpd.py</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Connect to the server via ftps</h2>
<p>On your local client: $ ftp &gt; open 139.162.141.181 &gt; username &gt; password &gt; ls</p>
<p>If you now see the text-file that is corresponding to the user you're all set: Congratulations</p>
<p><a class="anchor" id="autotoc_md12"></a> </p><h5>Managing user access to files</h5>
<p>Now that we've a running ftps server you might want to five multiple users access to the same file. Unfourntunatly ftp only supports access to one homedirectory. So if we want to keep users seperate we need to find a differnt way.</p>
<h6>Option 1: Copy and paste</h6>
<p>Would work in theory, but this approach is way to inefficient regarding disk space.</p>
<h6>Option 2: Hardlinks</h6>
<p>To Hardlink a file, is to create anathor pointer to the inode of the original file. The inode marks the true location of the original, which is in it self just anathor hardlink to that very inode.</p>
<p>What that means is, that we don't need massive amounts of additional space.</p>
<p>You can create a hardlink like this:</p>
<p>$ ln 'original file' 'path to destination'</p>
<p>Hardlinks have a trait, that is usally quite handy but unfortunate for us: If you delete the original the other links remain.</p>
<h6>Deleting hardlinks</h6>
<p>So how do we delete all hardlinks?</p>
<p>By using the inode number of the inode in which the content of our file is stored.</p>
<p>You can get the inode number by running this: $ ls -i your filename</p>
<p>Now we are going to use this inode number to do a little bit of dark magic, to find all hardlinks in and under the root directory and delete them:</p>
<p>$ find /root -inum 'inode number' | xargs rm</p>
<p>This can now be integrated with python. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
